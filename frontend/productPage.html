<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Beer shop</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
   <header>
       <h1><a href="index.html">Beer Shop</a></h1>
    </header>

    <main class="container">
        <section class="product-details">
            <div class="product-image">
                <img id="product-image" width="400" height="300" alt="Product Name">
            </div>
            <div class="product-info">
                <h2 class="product-title" id="product-title">Product Name</h2>
                <p class="product-description" id="product-desc">
                    This is a detailed description of the product. It highlights features, benefits, and specifications.
                </p>
                <div class="product-price" id="product-price">$49.99</div>
                <button class="btn-primary" id="add-cart">Add to Cart</button>
                <div class="product-fields">
                     <div class="product-field">
                        <span class="label">Loading...</span>
                        <span class="value">Loading...</span>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script>
        function addToCart(product) {
            let cart = JSON.parse(localStorage.getItem("cart") || "[]");
            const item = cart.find(i => i.id === product.id);
            if (item) {
                item.qty += 1;
            } else {
                cart.push({ ...product, qty: 1 });
            }

            localStorage.setItem("cart", JSON.stringify(cart));
        }

        fetch("/fetchProduct/" + new URLSearchParams(document.location.search).get("id"), {
            method: "GET"
        }).then(response => {
            if (response.status === 404) {
                window.location.href = "404.html";
            }
            return response.json();
        }).then(d => {
            document.getElementById("product-image").src = d.image_url
            document.getElementById("product-title").textContent = d.name
            document.getElementById("product-desc").innerHTML = d.description
            document.getElementById("product-price").textContent = d.price + "$"
            document.getElementById("add-cart").addEventListener("click", () => {
                addToCart(d)
                window.location.href = "index.html"
            });

            const fields = JSON.parse(d.fields);
            const fieldsContainer = document.querySelector(".product-fields");
            fieldsContainer.innerHTML = "";
            fields.forEach(field => {
                const fieldDiv = document.createElement("div");
                fieldDiv.className = "product-field";
                const labelSpan = document.createElement("span");
                labelSpan.className = "label";
                labelSpan.textContent = field.label + ":";
                const valueSpan = document.createElement("span");
                valueSpan.className = "value";
                valueSpan.textContent = field.value;
                fieldDiv.appendChild(labelSpan);
                fieldDiv.appendChild(valueSpan);
                fieldsContainer.appendChild(fieldDiv);
            });
        }).catch(err => {
            console.log(err);
            if (err.message === 'Product not found') {
                console.log("Product not found");
            } else {
                alert("An error occurred while fetching the product details.");
            }
        })
    </script>
</body>
</html>